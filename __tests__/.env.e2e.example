# E2E Test Environment Configuration
# Copy this file to __tests__/.env.e2e and fill in your test values.
# IMPORTANT: Use test databases and isolated queues to avoid conflicts with development.

# ==============================================================================
# INFRASTRUCTURE - Required for all E2E tests
# ==============================================================================

# Redis connection URL
# Use port 16379 (from docker-compose.e2e-test.yml) to avoid conflict with dev Redis
REDIS_URL=redis://localhost:16379

# Neo4j connection settings
# Use port 17687 (from docker-compose.e2e-test.yml) to avoid conflict with dev Neo4j
NEO4J_URI=bolt://localhost:17687
NEO4J_USER=neo4j
NEO4J_PASSWORD=e2e-test-password

# Queue isolation (prevents test jobs going to dev workers)
# This ensures E2E tests use a separate queue that won't be picked up by dev workers
BULLMQ_QUEUE_NAME=workflow-jobs-e2e

# ==============================================================================
# GITHUB APP - Required for webhook signature verification and API calls
# ==============================================================================

# Webhook secret for verifying incoming webhook payloads
# Get this from your GitHub App settings
GITHUB_WEBHOOK_SECRET=

# GitHub App ID (from GitHub App settings page)
GITHUB_APP_ID=

# Path to the GitHub App private key file (.pem)
# This should be an absolute path to the private key downloaded from GitHub
GITHUB_APP_PRIVATE_KEY_PATH=

# ==============================================================================
# TEST REPOSITORY CONFIGURATION - For true E2E webhook tests
# ==============================================================================

# The repository to test against (must have GitHub App installed)
# Format: owner/repo
TEST_REPO_FULL_NAME=speak-zhong-wen/website

# Pull request number to use for testing
# This should be a pre-existing test PR that the workflow can safely process
TEST_PR_NUMBER=

# GitHub username of the test user (must be repo owner or org admin)
TEST_GITHUB_USER=youngchingjui

# GitHub App installation ID for the test organization
# Find this in GitHub App settings > Installations, or from webhook payloads
TEST_INSTALLATION_ID=

# ==============================================================================
# WORKER CONFIGURATION - Required for the workflow worker
# ==============================================================================

# OpenAI API key for the AI workflow
OPENAI_API_KEY=

# Worker concurrency (optional, default: 1)
WORKER_CONCURRENCY=1

# Graceful shutdown timeout in ms (optional, default: 3600000 = 1 hour)
SHUTDOWN_TIMEOUT_MS=900000

# ==============================================================================
# OPTIONAL - Application URL (for tracking links in PR comments)
# ==============================================================================

# Base URL for the application (used in workflow tracking links)
# Optional - workflow will still work without it, just won't include tracking URLs
NEXT_PUBLIC_BASE_URL=http://localhost:3001

# ==============================================================================
# WEBHOOK FORWARDING - For receiving real GitHub webhooks locally
# ==============================================================================

# Smee.io channel URL for webhook forwarding
# Create a channel at https://smee.io and paste the URL here
SMEE_URL=https://smee.io/your-channel-id

# Test mode: set to "real-webhook" to use real GitHub webhooks via smee.io
# When set, the E2E test will:
# 1. Start the smee client to forward webhooks
# 2. Create a real comment on the test PR
# 3. Wait for GitHub to send the webhook through smee.io
# If not set or set to anything else, uses mock webhooks (default)
TEST_MODE=
